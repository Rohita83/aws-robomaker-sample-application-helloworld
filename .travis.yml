sudo: required
language: generic
dist: xenial
notifications:
  email:
    on_success: change
    on_failure: always
    recipients:
    - ros-contributions@amazon.com
    - travis-build@platform-notifications.robomaker.aws.a2z.com
env:
  global:
    - SA_NAME=hello-world
    - SA_PACKAGE_NAME=hello_world_robot
    - NO_TEST=true
    - GH_USER_NAME="travis-ci"
    - GH_USER_EMAIL="travis@travis-ci.org"
    - AWS_DEFAULT_REGION=us-west-2
    - secure: r7ITVOGxqbHTRi0kkZw9AbkrQmiS+wnLrQrmpsygrc0RTPHm92VdV98SqPt/4gSn8UaCfZ1YqWFDgk/z5mKD4SX5bUbyhGrd94vWNJML6rwbHwzRoWGvo+ZnafDXgduyuMcMdwOu7N0XwaqOhhwsgpi/NRZjBFg4mcPQms6nE890JG7d2G9es7mY6z4bQ3sjWnIqq7EV317Iy7ZzZIRTLcN1/xCCgPk88sHV395F7DPxQW7YEOn4C7qq67zJIvO5TyZOul1CHI7SbtkwfN8NZQFuO7wQlLiQ5yL37kDLyHRNs9pp+5S++WAcm7BUXIyhyi/OAZ17h0Z5GaMc+AXibi9UDML7iLNIEJID1NnLd6crb2VmjPoEkbqommlMkNM70R9OuBmViot7j//XM8E0b3uoZyvCx7JHRXyPnzqSFX9/dlHTIfHw1CT65c6pQWwJyWyEsy7G5Y4K18yZC6VefGvmX41ejm4qPtbrpkCayWIKnmqWt7ZI3qwyHCQaD9Sdy5nNv5OvCOZdzOrUFcW5BPu6WXCkV6zfI0lqNxY8dbR0Ifl34S1jBdCLvk+jZXOW0tTDM76/77QroZno3FTQSc0/xeCqtRoUT/4WgNHdBZxN04QiURLZhFUNg+qfjIVeQvIsfRDSEL+Qi8NZbO5MFzyN+kpxVqlBqITRxezLGpM=
    - secure: m0OH3tsk+Ba7bBWGzIbaZZlMDW8KbRgHbBclj4ImTMPZw+3CP5mCpgSRIIKr04H1vlR5028xP+vSxL7I2l+cIKEWx1CAQofHJg1bOmTUxqoAmMDY7OdU3vQs2BclEZO3YNbpl18DrSE8KsCJ5j5rvPJnl1SOEfzTXRK2wwiVazVcV0laj7871/MiRjPH+Zv2P+YOQzJ/xaI4nV1jXAm5gE/YdT0mTlgR8XV9JiLgfmy5mcAfbim6m4c5+HjvQxpatLc4jSVx6jn59kZmWNDVni+UyukN3J9mhwpIlg2Wduts0+kN6sgOYTL8ryQAugf/RMMKTTcHNXfMLjij6byMqJ6shQ+qr8LQjI7xDHS197PqbvFSCqBIMdqmTx7Jt3K7LLdaWpyFhNJZbKktqA8Oa2wB+ptNNVbeRek0cCawrs8dRFAkrGwlYRqHAulpPuXVpRSzpCDnBS4N+ZL9u/66o1fMD86oE1q38LF1UjlvFfMFWunT6UPiOVsFuAqWXiZ5b8L2H974YxFls1HvqqSWwe8SwFTv4Syi8Ft1Kid2wSo/5Zflyho0DYcbieRdl1LGlHOF3V/2Gyyzj+W5YNQt/IK9ZFcdNz4IPEHuPaSa2UWnNFIJQfZYuUNTzJEY7dzocAoPq5wM0/aB6GK8AMToSQtCYjJOD/XS5TTsiHf2FLc=
  matrix:
    - ROS_DISTRO=kinetic ROS_VERSION=1 GAZEBO_VERSION=7
matrix:
  allow_failures:
    - ROS_DISTRO=kinetic ROS_VERSION=1 GAZEBO_VERSION=9
before_install:
- pip install --user awscli
- openssl aes-256-cbc -K $encrypted_e9b424f4a194_key -iv $encrypted_e9b424f4a194_iv
  -in github_deploy.pem.enc -out github_deploy.pem -d
install:
- git clone -b development https://github.com/aws-robotics/travis-scripts.git .ros_ci
script:
- ". .ros_ci/configure_cc_git_credentials.sh"
- ". .ros_ci/add_tag.sh"
- ".ros_ci/ce_build.sh"
before_deploy:
- ". .ros_ci/before_deploy.sh"
deploy:
- provider: s3
  access_key_id: "$AWS_ACCESS_KEY_ID"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY"
  bucket: "$S3_BUCKET_NAME"
  local_dir: shared
  skip_cleanup: true
  wait-until-deployed: true
  upload-dir: travis/${SA_NAME}/${ROS_DISTRO}/gazebo${GAZEBO_VERSION}
  on:
    branch: abby-dev
- provider: script
  script: bash .ros_ci/codepipeline_deploy.sh
  on:
    branch: abby-dev
after_deploy:
- ".ros_ci/post_deploy.sh"
