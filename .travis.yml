sudo: required
language: generic
dist: xenial
notifications:
  email:
    on_success: change
    on_failure: always
    recipients:
    - ros-contributions@amazon.com
    - travis-build@platform-notifications.robomaker.aws.a2z.com
env:
  matrix:
  - ROS_DISTRO=kinetic ROS_VERSION=1 GAZEBO_VERSION=7
  allow_failures:
  - ROS_DISTRO=kinetic ROS_VERSION=1 GAZEBO_VERSION=9
  global:
  - SA_NAME=hello-world
  - SA_PACKAGE_NAME=hello_world_robot
  - NO_TEST=true
  - GH_USER_NAME="travis-ci"
  - GH_USER_EMAIL="travis@travis-ci.org"
  - AWS_DEFAULT_REGION=us-west-2
  - secure: rBK9gJNAUO/5uwD3U+DjLCA6kCoysr/+6AeRWexWEkfByUV3TzIkuQEQht1d9ktM3tvB6osuo2U9RYz84CYgVLyEtlpsn74tXqYk7gHlwxQcXjkdsE8ttpH2xsRg3W9z7tguml59KS7a/xCb7f7VfCSD6bVxOQ7fSKrF1okmew7VHBaSPKyE6sGhL5flf4tiE4nk4utJ71dDgS70/tgVAp7ruPB4f60MSs5+vV69OQ3EUddHDNj/ehFc+q6/Ezpdkik7FSai00zfjfGKtM1TejDNkMxhg3I8a8C/7MlXzw0hXqi/FrKxaAUYlZLmJcDuKH5vnsPD11oy8n3KaqMB3p/tbrngW9Jp5rXcNoklWvJMJWCDbJyqNK2xkjnb37TGN/vg9H78dgxVL22y/PdOiridUCTLD2DKTWLKl0RP7ANpP2w9gSBnAbNPiw8Hk/knpWcT0AfD98xIsqmmQdVjMMJYlP/Iz+zw+yKdauKrcLvSdHrOFILugP2+6g4jlZfhAvl0wpWABH8ain6ugvBRXOmdjtkxGQzOkMnDGpc1HZMETKz2dSDGy1r5oXBHKadzbEqleytZLHxAyu4eFaMRvHm3Yv1HwrQG/osVcLmuSlAJuGZ26Qp5n45W2z0jxX0KT7RfVq91I2bbaDJC5Px8NkC7JndsJClGTY1G3BKrY7I=
  - secure: QBJzBKUYu7dhiBsLhoAiugIcK35sgIPNrWZk0pcPuBfdEZD97NQjZYn5SdsOOLSUqchNQbIe2MKzQyU51xt0fnXbQ4Q3kmcbVd+Kao8Mk008/UvSwLO/FwUBqDSmJCa6Ulxv5FxH+cnlLwhqlgwCSfIbU9FPyERpvlSfYwHWS9PaMqQEo2s7LcU3HiXz4mUjKcT5r9NG66TFQTT7n6bs+Rp4Pd+OArs/PnskRUJ624zaFQaiHCK9y+glvUZ26jGbqAsMUaUHlvDQCkNWdolCqr6gnjFopD7MbtRdzGW1jWHpAZ2wXj21ibh+CsKh9ccbbpAIsugrvwCV3LYWU2Fo8eWKAtDdf90SyDKpPkIufB1vx5DG2ufmFXTwwRlMICbak0XrqRB8rFRyOBukOgEiLGUJJkgwamB+NtUyHs5axT4JQeTVPDg8JgDq+z1g/jrwAeqk/rrLOVZlmdH9kKrBYDGkgcXENyf/utxv8yulZPrJYkAkG1cgS9zmhwm40yzjI1B1AhtiLwx6qkHUYzGxnW5gFmneZSdv8WZEmZF7EdaxZgUQCj5p0SVNG4vaarOtdi/gz+v/W07ZXQH5ea1h+ygQ3RhDtq4K87Md9U3Son0rwBS4R+yrVNYlzj0TKIaho6uFQUNOtxMO+8oUQcNX7yvLf24NJsM6+QKxWmtyJdE=
before_install:
- pip install --user awscli
- openssl aes-256-cbc -K $encrypted_e9b424f4a194_key -iv $encrypted_e9b424f4a194_iv
  -in github_deploy.pem.enc -out github_deploy.pem -d
install:
- git clone -b development https://github.com/aws-robotics/travis-scripts.git .ros_ci
script:
- ". .ros_ci/configure_cc_git_credentials.sh"
- ". .ros_ci/add_tag.sh"
- ".ros_ci/ce_build.sh"
before_deploy:
- ". .ros_ci/before_deploy.sh"
deploy:
- provider: s3
  access_key_id: "$AWS_ACCESS_KEY_ID"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY"
  bucket: "$S3_BUCKET_NAME"
  local_dir: shared
  skip_cleanup: true
  wait-until-deployed: true
  upload-dir: travis/${SA_NAME}/${ROS_DISTRO}/gazebo${GAZEBO_VERSION}
- provider: script
  script: bash .ros_ci/codepipeline_deploy.sh
after_deploy:
- ".ros_ci/post_deploy.sh"
